
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the UAntwerpen-modules repository">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>The SitePackage.lua file and its included LUA files - UAntwerpen-modules documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-sitepackagelua-file-and-its-included-routines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="UAntwerpen-modules documentation" class="md-header__button md-logo" aria-label="UAntwerpen-modules documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UAntwerpen-modules documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The SitePackage.lua file and its included LUA files
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent=""  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="UAntwerpen-modules documentation" class="md-nav__button md-logo" aria-label="UAntwerpen-modules documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    UAntwerpen-modules documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../design_decisions/" class="md-nav__link">
        Design decisions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../modules_calcua-init/" class="md-nav__link">
        The CalcUA-init module
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../modules_calcua_and_clusterarch/" class="md-nav__link">
        The generic calcua and clusterarch modules
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../scripts/" class="md-nav__link">
        Scripts
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          The SitePackage.lua file and its included LUA files
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        The SitePackage.lua file and its included LUA files
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#naming-conventions" class="md-nav__link">
    Naming conventions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#etcsystemdefinitionlua" class="md-nav__link">
    etc/SystemDefinition.lua
  </a>
  
    <nav class="md-nav" aria-label="etc/SystemDefinition.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clustermod_nodetypes" class="md-nav__link">
    ClusterMod_NodeTypes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_systemtable" class="md-nav__link">
    ClusterMod_SystemTable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_systemproperies" class="md-nav__link">
    ClusterMod_SystemProperies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_clustermap" class="md-nav__link">
    ClusterMod_ClusterMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_toolchain_map" class="md-nav__link">
    ClusterMod_toolchain_map
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_map_arch_hierarchy" class="md-nav__link">
    ClusterMod_map_arch_hierarchy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_def_cpu" class="md-nav__link">
    ClusterMod_def_cpu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_map_cpu_to_gen" class="md-nav__link">
    ClusterMod_map_cpu_to_gen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_reduce_cpu" class="md-nav__link">
    ClusterMod_reduce_cpu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_reduce_top_arch" class="md-nav__link">
    ClusterMod_reduce_top_arch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sitepackage_map_toolchainlua" class="md-nav__link">
    SitePackage_map_toolchain.lua
  </a>
  
    <nav class="md-nav" aria-label="SitePackage_map_toolchain.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structures" class="md-nav__link">
    Data structures
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routines" class="md-nav__link">
    Routines
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sitepackage_arch_hierarchylua" class="md-nav__link">
    SitePackage_arch_hierarchy.lua
  </a>
  
    <nav class="md-nav" aria-label="SitePackage_arch_hierarchy.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structures_1" class="md-nav__link">
    Data structures
  </a>
  
    <nav class="md-nav" aria-label="Data structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-other-files" class="md-nav__link">
    From other files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map_os_long_to_short" class="md-nav__link">
    map_os_long_to_short
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map_cpu_long_to_short" class="md-nav__link">
    map_cpu_long_to_short
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map_accel_long_to_short" class="md-nav__link">
    map_accel_long_to_short
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routines_1" class="md-nav__link">
    Routines
  </a>
  
    <nav class="md-nav" aria-label="Routines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discover-the-architecture-hierarchy" class="md-nav__link">
    Discover the architecture hierarchy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping-between-different-formats-of-names" class="md-nav__link">
    Mapping between different formats of names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extracting-parts-from-the-os-cpu-accelerator-strings" class="md-nav__link">
    Extracting parts from the os-cpu-accelerator strings:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-matching-architectures-in-software-stacks" class="md-nav__link">
    Computing matching architectures in software stacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-directories" class="md-nav__link">
    Computing directories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#miscellaneous-functions" class="md-nav__link">
    Miscellaneous functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sitepackage_system_infolua" class="md-nav__link">
    SitePackage_system_info.lua
  </a>
  
    <nav class="md-nav" aria-label="SitePackage_system_info.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structures_2" class="md-nav__link">
    Data structures
  </a>
  
    <nav class="md-nav" aria-label="Data structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mappings-to-long-names" class="md-nav__link">
    Mappings to long names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mappings-to-short-names" class="md-nav__link">
    Mappings to short names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-data-structures" class="md-nav__link">
    Other data structures
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routines_2" class="md-nav__link">
    Routines
  </a>
  
    <nav class="md-nav" aria-label="Routines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_hostname" class="md-nav__link">
    get_hostname()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_clustername" class="md-nav__link">
    get_clustername()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_stackname" class="md-nav__link">
    get_stackname()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_cpu_info" class="md-nav__link">
    get_cpu_info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_os_info" class="md-nav__link">
    get_os_info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_accelerator_info" class="md-nav__link">
    get_accelerator_info
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_cluster_osarch" class="md-nav__link">
    get_cluster_osarch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_clusterarch" class="md-nav__link">
    get_clusterarch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_fullos" class="md-nav__link">
    get_fullos()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sitepackage_helperlua" class="md-nav__link">
    SitePackage_helper.lua
  </a>
  
    <nav class="md-nav" aria-label="SitePackage_helper.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structures_3" class="md-nav__link">
    Data structures
  </a>
  
    <nav class="md-nav" aria-label="Data structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clustermod_sorted_archmap_keys" class="md-nav__link">
    ClusterMod_sorted_archmap_keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_sorted_cputogen_keys" class="md-nav__link">
    ClusterMod_sorted_cputogen_keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_sorted_toparchreduction_keys" class="md-nav__link">
    ClusterMod_sorted_toparchreduction_keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routines_3" class="md-nav__link">
    Routines
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../easybuild/" class="md-nav__link">
        EasyBuild configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../directory_structure/" class="md-nav__link">
        Directory structure of the repositories and software stack
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../procedures/" class="md-nav__link">
        Procedures
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../Development/">Development</a>
          
            <label for="__nav_10">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Development/debug_scripts/" class="md-nav__link">
        Test scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Development/design_considerations/" class="md-nav__link">
        Design considerations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#naming-conventions" class="md-nav__link">
    Naming conventions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#etcsystemdefinitionlua" class="md-nav__link">
    etc/SystemDefinition.lua
  </a>
  
    <nav class="md-nav" aria-label="etc/SystemDefinition.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clustermod_nodetypes" class="md-nav__link">
    ClusterMod_NodeTypes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_systemtable" class="md-nav__link">
    ClusterMod_SystemTable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_systemproperies" class="md-nav__link">
    ClusterMod_SystemProperies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_clustermap" class="md-nav__link">
    ClusterMod_ClusterMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_toolchain_map" class="md-nav__link">
    ClusterMod_toolchain_map
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_map_arch_hierarchy" class="md-nav__link">
    ClusterMod_map_arch_hierarchy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_def_cpu" class="md-nav__link">
    ClusterMod_def_cpu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_map_cpu_to_gen" class="md-nav__link">
    ClusterMod_map_cpu_to_gen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_reduce_cpu" class="md-nav__link">
    ClusterMod_reduce_cpu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_reduce_top_arch" class="md-nav__link">
    ClusterMod_reduce_top_arch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sitepackage_map_toolchainlua" class="md-nav__link">
    SitePackage_map_toolchain.lua
  </a>
  
    <nav class="md-nav" aria-label="SitePackage_map_toolchain.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structures" class="md-nav__link">
    Data structures
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routines" class="md-nav__link">
    Routines
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sitepackage_arch_hierarchylua" class="md-nav__link">
    SitePackage_arch_hierarchy.lua
  </a>
  
    <nav class="md-nav" aria-label="SitePackage_arch_hierarchy.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structures_1" class="md-nav__link">
    Data structures
  </a>
  
    <nav class="md-nav" aria-label="Data structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-other-files" class="md-nav__link">
    From other files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map_os_long_to_short" class="md-nav__link">
    map_os_long_to_short
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map_cpu_long_to_short" class="md-nav__link">
    map_cpu_long_to_short
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map_accel_long_to_short" class="md-nav__link">
    map_accel_long_to_short
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routines_1" class="md-nav__link">
    Routines
  </a>
  
    <nav class="md-nav" aria-label="Routines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discover-the-architecture-hierarchy" class="md-nav__link">
    Discover the architecture hierarchy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping-between-different-formats-of-names" class="md-nav__link">
    Mapping between different formats of names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extracting-parts-from-the-os-cpu-accelerator-strings" class="md-nav__link">
    Extracting parts from the os-cpu-accelerator strings:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-matching-architectures-in-software-stacks" class="md-nav__link">
    Computing matching architectures in software stacks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-directories" class="md-nav__link">
    Computing directories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#miscellaneous-functions" class="md-nav__link">
    Miscellaneous functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sitepackage_system_infolua" class="md-nav__link">
    SitePackage_system_info.lua
  </a>
  
    <nav class="md-nav" aria-label="SitePackage_system_info.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structures_2" class="md-nav__link">
    Data structures
  </a>
  
    <nav class="md-nav" aria-label="Data structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mappings-to-long-names" class="md-nav__link">
    Mappings to long names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mappings-to-short-names" class="md-nav__link">
    Mappings to short names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-data-structures" class="md-nav__link">
    Other data structures
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routines_2" class="md-nav__link">
    Routines
  </a>
  
    <nav class="md-nav" aria-label="Routines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_hostname" class="md-nav__link">
    get_hostname()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_clustername" class="md-nav__link">
    get_clustername()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_stackname" class="md-nav__link">
    get_stackname()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_cpu_info" class="md-nav__link">
    get_cpu_info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_os_info" class="md-nav__link">
    get_os_info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_accelerator_info" class="md-nav__link">
    get_accelerator_info
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_cluster_osarch" class="md-nav__link">
    get_cluster_osarch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_clusterarch" class="md-nav__link">
    get_clusterarch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_fullos" class="md-nav__link">
    get_fullos()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sitepackage_helperlua" class="md-nav__link">
    SitePackage_helper.lua
  </a>
  
    <nav class="md-nav" aria-label="SitePackage_helper.lua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-structures_3" class="md-nav__link">
    Data structures
  </a>
  
    <nav class="md-nav" aria-label="Data structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clustermod_sorted_archmap_keys" class="md-nav__link">
    ClusterMod_sorted_archmap_keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_sorted_cputogen_keys" class="md-nav__link">
    ClusterMod_sorted_cputogen_keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clustermod_sorted_toparchreduction_keys" class="md-nav__link">
    ClusterMod_sorted_toparchreduction_keys
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routines_3" class="md-nav__link">
    Routines
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="the-sitepackagelua-file-and-its-included-routines">The SitePackage.lua file and its included routines</h1>
<ul>
<li>
<p><code>SitePackage_map_toolchain.lua</code> : Mapping regular toolchain names onto yyy.mm for
    comparisons to find matching versions of some files.</p>
</li>
<li>
<p><code>SitePackage_arch_hierarchy.lua</code> : Routines to work with the hierarchy of
    architectures and map between long and short names.</p>
</li>
<li>
<p><code>SitePackage_system_info.lua</code>: Routines to gather information about the system.</p>
</li>
<li>
<p><code>SitePackage_helper.lua</code>: Other routines and data structures.</p>
</li>
</ul>
<p>Some of the data structures, in particular those that need to be extended with each
new toolchain and really define the setup of the system, are not in the LMOD subdirectory
but instead in the file <code>etc/SystemDefinition.lua</code>.</p>
<h2 id="naming-conventions">Naming conventions</h2>
<ul>
<li>Full 3-component architecture: <code>osarch</code> (where possible)</li>
<li>Full 2-component architecture without OS: <code>arch</code> (where possible)</li>
<li>Supported OS as name + version: <code>os</code> </li>
<li>2-component architecture (CPU + accelerator): <code>modarch</code></li>
</ul>
<p>Note that we discussed a 2-level scheme where we always use the shortest name possible
(hence avoiding <code>-noaccel</code>) but this is not implemented as we feel it may create confusion
and as it also complicates the implementation.</p>
<h2 id="etcsystemdefinitionlua">etc/SystemDefinition.lua</h2>
<p><strong>TODO: Some clean-up. Some of these tables could be generated automatically in <code>SitePackage_helper.lua</code>?</strong></p>
<h3 id="clustermod_nodetypes"><code>ClusterMod_NodeTypes</code></h3>
<p>ClusterMod_NodeTypes is simply n array of nodes in the system, specified using
the long os-CPU-accelerator names.</p>
<p>As this is a description of the current hardware in the cluster, it is not
for a specific version of the software stack. The table is used to produce
output for debug purposes of this configuration file, e.g., to list which
software stacks for which architectures will be available on which node 
types.</p>
<p>Note that one should distinguish between the generic processor types and 
the real processor types. No node type in the table below should have a 
generic processor type in its name as that would cause problems with 
the 3-level software architecture schemes (and make coding more difficult even for the
2-level software architecture scheme).</p>
<p>Example: At the time of writing, the CalcUA cluster description would have been:
<div class="highlight"><pre><span></span><code><span class="n">ClusterMod_NodeTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;redhat7-ivybridge-noaccel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat7-broadwell-noaccel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat8-broadwell-noaccel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat8-broadwell-pascal&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat8-broadwell-P5000&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat8-skylake-noaccel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat8-skylake-aurora1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat8-zen2-noaccel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat8-zen2-ampere&#39;</span><span class="p">,</span>
    <span class="s1">&#39;redhat8-zen2-arcturus&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="clustermod_systemtable"><code>ClusterMod_SystemTable</code></h3>
<p><code>ClusterMod_SystemTable</code> defines the whole structure of the software tree, including the manually
installed software and system-wide EasyBuild managed software. Note that the table will be
completed automatically with more generic os-cpu-accelerator architecture strings based
on the other tables in this file.</p>
<p>All names used should be for the 3L scheme. However, the middle level should not be used 
for versions that will use a 2L_long naming scheme.</p>
<p><div class="highlight"><pre><span></span><code><span class="n">ClusterMod_SystemTable</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;redhat7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">[</span><span class="s1">&#39;redhat8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">[</span><span class="s1">&#39;manual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;redhat7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">[</span><span class="s1">&#39;redhat8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">[</span><span class="s1">&#39;2020a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;redhat7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ivybridge-noaccel&#39;</span><span class="p">,</span>
            <span class="s1">&#39;broadwell-noaccel&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">[</span><span class="s1">&#39;redhat8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;zen2-noaccel&#39;</span><span class="p">,</span>
            <span class="s1">&#39;skylake-noaccel&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">[</span><span class="s1">&#39;2021b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;redhat7&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ivybridge-noaccel&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">[</span><span class="s1">&#39;redhat8&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;broadwell-noaccel&#39;</span><span class="p">,</span>
            <span class="s1">&#39;zen2-noaccel&#39;</span><span class="p">,</span>
            <span class="s1">&#39;skylake-noaccel&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
The structure is a table of tables.</p>
<ul>
<li>The keys on the first level are the versions of the software stacks, with two special version:
    <code>system</code> and <code>manual</code>.</li>
<li>The keys on the second level are the long OS versions (name+version as used in the 
    architecture identifiers)</li>
<li>The values are then the CPU architecture + accelerator for each software stack + OS combo.
    Only the most specific architecture needs to be given, the others are derived automatically
    from other tables.</li>
</ul>
<h3 id="clustermod_systemproperies"><code>ClusterMod_SystemProperies</code></h3>
<p><code>ClusterMod_SystemProperies</code> adds additional information for each partition that is not contained
in <code>ClusterMod_SystemTable</code>. It is a table of tables, the first index is the name of the calcua
stack or <code>manual</code> for the pseudo-stack of manually installed software. The table for each
software stack has the following entries:</p>
<ul>
<li>
<p><code>EasyBuild</code>: Default version of EasyBuild for this stack. Should not be defined for the
    manual stack.</p>
</li>
<li>
<p><code>hierarchy</code>: Type of architecture hierarchy used for this software stack. Currently only 
    the first option is implemented:</p>
<ol>
<li>
<p><code>2L</code>: two levels, the least generic level always includes an accelerator field</p>
</li>
<li>
<p><code>3L</code>: 3 levels in the architecture hierarchy.</p>
</li>
</ol>
</li>
</ul>
<h3 id="clustermod_clustermap"><code>ClusterMod_ClusterMap</code></h3>
<p><code>ClusterMod_ClusterMap</code> contains for each version of the calcua toolchains, including
the dummy system version, a mapping from cluster names to os-architecture strings.
Each should be the topmost supported architecture for a particular node type.</p>
<div class="highlight"><pre><span></span><code><span class="n">ClusterMod_ClusterMap</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;hopper&#39;</span><span class="p">]</span> <span class="o">=</span>      <span class="s1">&#39;redhat7-x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;leibniz&#39;</span><span class="p">]</span> <span class="o">=</span>     <span class="s1">&#39;redhat8-x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;leibniz-skl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;redhat8-x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;vaughan&#39;</span><span class="p">]</span> <span class="o">=</span>     <span class="s1">&#39;redhat8-x86_64&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">[</span><span class="s1">&#39;2020a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;hopper&#39;</span><span class="p">]</span> <span class="o">=</span>      <span class="s1">&#39;redhat7-ivybridge-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;leibniz&#39;</span><span class="p">]</span> <span class="o">=</span>     <span class="s1">&#39;redhat7-broadwell-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;leibniz-skl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;redhat8-skylake-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;vaughan&#39;</span><span class="p">]</span> <span class="o">=</span>     <span class="s1">&#39;redhat8-zen2-noaccel&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">[</span><span class="s1">&#39;2021b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;hopper&#39;</span><span class="p">]</span> <span class="o">=</span>      <span class="s1">&#39;redhat7-ivybridge-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;leibniz&#39;</span><span class="p">]</span> <span class="o">=</span>     <span class="s1">&#39;redhat8-broadwell-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;leibniz-skl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;redhat8-skylake-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;vaughan&#39;</span><span class="p">]</span> <span class="o">=</span>     <span class="s1">&#39;redhat8-zen2-noaccel&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ClusterMod_ClusterMap</code> is an associative table-of-tables. </p>
<ul>
<li>On the first level, the keys are the various versions of the software stack visible to
    users (and can include <code>system</code>)</li>
<li>On the second level, the keys are the names of the clusters that we want to map on a 
    particular architecture.</li>
<li>The values are then the architecture strings, in the formats specified in 
    <code>ClusterMod_SystemProperties</code>.</li>
</ul>
<h3 id="clustermod_toolchain_map"><code>ClusterMod_toolchain_map</code></h3>
<p><code>ClusterMod_toolchain_map</code> is an associative table, with the yyyy[a|b] toolchains as the keys and
the matching yyyymm value as the value (note: no dot, not yyyy.mm)</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">ClusterMod_toolchain_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;200000&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;manual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;200000&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;2020a&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;202001&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;2020b&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;202007&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;2021a&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;202101&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;2021b&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;202107&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;2022a&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;202201&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="clustermod_map_arch_hierarchy"><code>ClusterMod_map_arch_hierarchy</code></h3>
<p><code>ClusterMod_map_arch_hierarchy</code> is an associative table of associative tables with for each supported
OS a table that can be used to determine the parent of every CPU/accelerator
architecture.</p>
<ul>
<li>
<p>First level: The keys are the yyyymm versions of toolchains, the values the matching
    associative table. These toolchain versions are "starting from", so not every toolchain
    needs to be specified.</p>
</li>
<li>
<p>Second level: Associative table with as keys the CPU/GPU architecture
    string and as value the parent GPU/architecture string, or <code>nil</code> if it is
    the top (= most generic) architecture.</p>
</li>
</ul>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">ClusterMod_map_arch_hierarchy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">-- We start with a 2-level map</span>
    <span class="p">[</span><span class="s1">&#39;200000&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;zen2-noaccel&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;zen2-ampere&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;zen2-arcturus&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;broadwell-noaccel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;broadwell-P5000&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;broadwell-pascal&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;skylake-noaccel&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;skylake-aurora1&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;ivybridge-noaccel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;x86_64&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>TODO: Can we get rid of the above data structure?</p>
<h3 id="clustermod_def_cpu"><code>ClusterMod_def_cpu</code></h3>
<p><code>ClusterMod_def_cpu</code> is an associative table of associative tables defining
the  CPU architectures and whether they are generic or not.</p>
<ul>
<li>
<p>First level: The keys are the yyyymm versions of toolchains, the values the matching
    associative table. These toolchain versions are "starting from", so not every toolchain
    needs to be specified.</p>
</li>
<li>
<p>Second level: Associative table with as keys the CPU type (long names) and as value
    <code>true</code> for generic CPU architectures and false otherwise.</p>
</li>
</ul>
<p>The map is versioned, but do expect problems with finding the
right version of the system stack for a regular stack if all of a
sudden a regular CPU would become generic or vice-versa, so in 
practice it is very likely only one version will ever be needed
as it can be safely extended with new types.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">ClusterMod_def_cpu</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;zen4&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;zen3&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;zen2&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;skylake&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;broadwell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;ivybridge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;x86_64&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="clustermod_map_cpu_to_gen"><code>ClusterMod_map_cpu_to_gen</code></h3>
<p><code>ClusterMod_map_cpu_to_gen</code> is an associative table of associative tables with for each supported
OS a table that can be used to determine the generic architecture for every CPU.</p>
<ul>
<li>
<p>First level: The keys are the yyyymm versions of toolchains, the values the matching
    associative table. These toolchain versions are "starting from", so not every toolchain
    needs to be specified.</p>
</li>
<li>
<p>Second level: Associative table with as keys the CPU names and as the value
    the generic CPU type for this CPU, or nil if it is already a generic one.</p>
</li>
</ul>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">ClusterMod_map_cpu_to_gen</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;200000&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;zen3&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;zen2&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;skylake&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;broadwell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;ivybridge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;x86_64&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="clustermod_reduce_cpu"><code>ClusterMod_reduce_cpu</code></h3>
<p><code>ClusterMod_reduce_cpu</code> is an associative table of associative tables with for each supported
OS a table that can be used to determine a compatible but less capable version of the CPU,
until we end at the generic architectures. If the key is a generic architecture, the value
also has to be a generic architecture, or 'nil' if the tree/chain of architectures ends 
there.</p>
<ul>
<li>
<p>First level: The keys are the yyyymm versions of toolchains, the values the matching
    associative table. These toolchain versions are "starting from", so not every toolchain
    needs to be specified.</p>
</li>
<li>
<p>Second level: Associative table with as keys the CPU names and as the value
    the next compatible but less capable architecture, i.e., all software for the
    CPU as value should also run on the CPU as key but not always the other way
    around.</p>
</li>
</ul>
<p>For each stack in ClusterMod_SystemTable, these reduction rules have to be compatible
with the matching ones in ClusterMod_reduce_top_arch. I.e., if somehow
CPU1-Accel1 in ClusterMod_reduce_top_arch reduces to CPU2-Accel2 then it must 
also be possible to reduce CPU1 to CPU2 (in one or more steps) using the
rules specified in the <code>ClusterMod_reduce_top_arch</code> table below.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">ClusterMod_reduce_cpu</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;200000&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;zen3&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s1">&#39;zen2&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;zen2&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s1">&#39;broadwell&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;broadwell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ivybridge&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;ivybridge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;x86_64&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="clustermod_reduce_top_arch"><code>ClusterMod_reduce_top_arch</code></h3>
<p><code>ClusterMod_reduce_top_arch</code> is an associative table of associative tables with for each supported
OS a table that can be used to walk a chain of compatible but less specific architectures when 
looking for an architecture that is supported for a particular version of a software stack.</p>
<p>As we forsee that this may change in incompatible ways in the future, there is a level that indexes
with a yyyymm starting version of the software stacks.</p>
<ul>
<li>
<p>First level: The keys are the yyyymm versions of software stacks, the values the matching
    associative table. These toolchain versions are "starting from", so not every toolchain
    needs to be specified.</p>
</li>
<li>
<p>Second level: Associative table with as keys the parten CPU/GPU architecture
    string and as value the child-GPU/architecture string or sub-architecture, 
    or <code>nil</code> if it is the top (= most generic) architecture.</p>
</li>
</ul>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">ClusterMod_reduce_top_arch</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;200000&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="s1">&#39;zen2-ampere&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="s1">&#39;zen2-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;zen2-arcturus&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="s1">&#39;zen2-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;zen2-noaccel&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s1">&#39;broadwell-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;skylake-aurora1&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;skylake-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;skylake-noaccel&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;broadwell-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;broadwell-noaccel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ivybridge-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;broadwell-P5000&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;broadwell-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;broadwell-pascal&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;broadwell-noaccel&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;ivybridge-noaccel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;x86_64&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="sitepackage_map_toolchainlua">SitePackage_map_toolchain.lua</h2>
<h3 id="data-structures">Data structures</h3>
<ul>
<li>Uses <code>ClusterMod_toolchain_map</code> from <code>etc/SystemDefinition.lua</code></li>
</ul>
<h3 id="routines">Routines</h3>
<ul>
<li>
<p><code>map_toolchain</code>:  Returns the matching yyyymm toolchain for any toolchain. The
    input argument can be either a yyyy.mm toolchain version (in which case the
    routine simply returns that version without the dot) or a yyyy[a|b] version in
    which case the routine uses the <code>ClusterMod_toolchain_map</code> to compute the matching
    yyyymm version or falls back to a default rule (where a becomes 01 and b becomes
    07).</p>
</li>
<li>
<p><code>get_versionedfile</code>: Finds the most recent file (in terms of version encoded in the
    name of the file) with version not older than a
    given toolchain, with the file matching a particular pattern given as a directory,
    part before the version and part after the version. The version can be in any
    format supported by <code>map_toolchain</code>: yyyy[a|b], yyyy.mm, yyyymm, <code>system</code>.</p>
</li>
</ul>
<h2 id="sitepackage_arch_hierarchylua">SitePackage_arch_hierarchy.lua</h2>
<h3 id="data-structures_1">Data structures</h3>
<h4 id="from-other-files">From other files</h4>
<ul>
<li>Uses <code>ClusterMod_map_arch_hierarchy</code> from <code>etc/SystemDefinition.lua</code>.</li>
</ul>
<h4 id="map_os_long_to_short"><code>map_os_long_to_short</code></h4>
<p><code>map_os_long_to_short</code> maps long names of the OS to their short equivalent
(name does not include the version).</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">map_os_long_to_short</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;redhat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RH&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="map_cpu_long_to_short"><code>map_cpu_long_to_short</code></h4>
<p><code>map_cpu_long_to_short</code> maps the long CPU name to their short equivalent.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">map_cpu_long_to_short</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;x86_64&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;zen3&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s1">&#39;zen3&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;zen2&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="s1">&#39;zen2&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;ivybridge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;IVB&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;broadwell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BRW&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;skylake&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;SKLX&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="map_accel_long_to_short"><code>map_accel_long_to_short</code></h4>
<p><code>map_accel_long_to_short</code> maps the accelerator architecture from their long
name to their short equivalent.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="n">map_accel_long_to_short</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s1">&#39;noaccel&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;host&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;P5000&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="s1">&#39;NVGP61GL&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;pascal&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;NVCC60&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;ampere&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;NVCC80&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;arcturus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GFX908&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;aurora1&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;NEC1&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="routines_1">Routines</h3>
<h4 id="discover-the-architecture-hierarchy">Discover the architecture hierarchy</h4>
<ul>
<li>
<p><code>get_osarchs</code>: For a given OS (long name + version) and architecture
    (long name, CPU + optionally accelerator), return a table which also includes
    the parent and potentially grandparent of the architecture for the given OS.</p>
<p>The order in the table is from the least generic architecture to the most
generic one.</p>
</li>
<li>
<p><code>get_osarchs_reverse</code>: Same as <code>get_osarchs</code>, but now with the
    most generic one first and least generic one (the one used as the argument
    of the function) last.</p>
</li>
</ul>
<h4 id="mapping-between-different-formats-of-names">Mapping between different formats of names</h4>
<ul>
<li>
<p><code>map_long_to_short</code>: Map full long name (OS+version-CPU-accelerator) to the
    equivalent short name. It also works for names that do not include the
    accelerator.</p>
</li>
<li>
<p><code>map_short_to_long</code>: Map full short name (OS+version-CPU-accelerator) to the
    equivalent long name. It also works for names that do not include the
    accelerator.</p>
</li>
</ul>
<h4 id="extracting-parts-from-the-os-cpu-accelerator-strings">Extracting parts from the os-cpu-accelerator strings:</h4>
<ul>
<li>
<p><code>extract_os</code>  : Extracts the first part of the os-cpu-acceleartor argument</p>
</li>
<li>
<p><code>extract_cpu</code> : Extracts the second part of the os-cpu-accelerator argument</p>
</li>
<li>
<p><code>extract_accel</code> : Extracts the third part of the os-cpu-accelerator argument,
    or returns <code>nil</code> if there is no accelerator part in the argument.</p>
</li>
<li>
<p><code>extract_arch</code> : Extracts the second and (optional) third part of the
    os-cpu-accelerator argument, i.e., returns cpu-accelerator or just cpu if there
    is no accelerator part.</p>
</li>
<li>
<p><code>extract_cpu_from_arch</code>: Extracts the first part of the cpu-accelerator argument</p>
</li>
<li>
<p><code>extract_accel_from_arch</code>: Extracts the second part of the cpu-accelerator argument</p>
</li>
</ul>
<h4 id="computing-matching-architectures-in-software-stacks">Computing matching architectures in software stacks</h4>
<ul>
<li>
<p><code>get_stack_osarch_current( stack_version )</code></p>
<p><strong>Input argument:</strong></p>
<ul>
<li><code>stack_version</code>: Version of the calcua stack, can be <code>system</code>.</li>
</ul>
<p><strong>Return value:</strong> </p>
<ul>
<li>The architecture of the current node with long names and in a
    format compatible with the indicated software stack (so taking into 
    account the hierarchy types 2L or 3L).</li>
</ul>
</li>
<li>
<p><code>get_stack_generic( clusterarch, stack_version )</code>: Compute the most generic
    architecture for the given version of the CalcUA stack on the given clusterarch
    architecture. The clusterarch argument has to be in the long format compatible
    with the CalcUA stack version.</p>
</li>
<li>
<p><code>get_stack_generic_current( stack_version )</code>: Compute the most generic
    architecture for the given version of the CalcUA stack on the current
    architecture.</p>
</li>
<li>
<p><code>get_stack_top( osarch, stack_version )</code>:</p>
<p><strong>Input arguments:</strong></p>
<ul>
<li>
<p><code>osarch</code>: os and architecture with long names and in a format 
    compatible with the indicated version of the software stack (so respecting
    the hierarchy types 2L or 3L).</p>
</li>
<li>
<p><code>stack_version</code>: Version of the calcua stack, can be system.</p>
</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li>The most specific os-architecture for the current node in the indicated
    version of the CalcUA software stacks.</li>
</ul>
</li>
<li>
<p><code>get_stack_matchingarch( osarch, reduce_stack_version, stack_version )</code>:</p>
<p><strong>Input arguments:</strong></p>
<ul>
<li>
<p><code>osarch</code>: os and architecture with long names and in a format 
    compatible with the indicated version of the software stack (so respecting
    the hierarchy types 2L or 3L).</p>
</li>
<li>
<p><code>reduce_stack_version</code>: Stack version to use for the reduction rules of
    both os-CPU-accel and os-CPU names.</p>
</li>
<li>
<p><code>stack_version</code>: Version of the calcua stack, can be system for which the
    best matching architecture should be returned. If <code>stack_version</code> is a 
    3L hierarchy, this can be a middle level one if <code>osarch</code> is also a 
    middle level name (which implies that <code>reduce_stack_version</code> is also a
    3L hierarchy)</p>
</li>
</ul>
<p><strong>Return value:</strong></p>
<ul>
<li>The most specific os-architecture for the current node in the indicated
    version of the CalcUA software stacks.</li>
</ul>
<p>The precise rules for the matching are very tricky. The thing that makes this
routine very tricky is that it will also be used in middle level arch modules 
for 3L stacks, and that there also one must be able to find a good module in 
the <code>system</code> stack which may be 2L or 3L.</p>
<p>Cases:
-   <code>osarch</code> is of type OS-generic CPU. As we currently have no rules 
    to reduce generic CPUs to an even less capable generic one, we produce
    <code>nil</code> if <code>osarch</code> is not supported by <code>stack_version</code> and return
    <code>osarch</code> otherwise.
-   <code>osarch</code> is of type OS-CPU, i.e., a middle level architecture for a 
    3L hierarchy. This implies that <code>reduce_stack_version</code> must be a 3L stack.</p>
<pre><code>There are now 2 options:
-   `stack_version` is also a 3L hierarchy: We use the reduction rules for 
    CPUs for `reduce_stack_version` to find a middle level or bottom/generic
    level supported by `stack_version`. 
-   `stack_version` is a 2L hierarchy: We use the mapping to generic CPU 
    defined by `ClusterMod_map_cpu_to_gen` for `reduce_stackversion` to find
    the matching generic CPU and then continue using the CPU chaining
    rules defined by
</code></pre>
<ul>
<li><code>osarch</code> is of type os-generic CPU: We follow the CPU reduction path
    for <code>reduce_stack_version</code> to see if we can find a match in the generic
    architectures supported by <code>stack_version</code>.</li>
</ul>
</li>
</ul>
<h4 id="computing-directories">Computing directories</h4>
<ul>
<li>
<p><code>get_system_module_dir( osarch, stack_name, stack_version )</code>: Compute the system module directory 
    from the three input arguments: long os-and-architecture name, stack name and stack version.</p>
<p>The directory name is an absolute path.</p>
<p>Note <code>system</code> in the name does not denote the <code>system</code> stack but the whole
system installation, versus the user installation.</p>
</li>
<li>
<p><code>get_system_module_dirs( osarch, stack_name, stack_version )</code>: Compute the system module directory 
    hierarchy from the three input arguments: long os-and-architecture name, stack name and stack version.</p>
<p>The directory names returned are absolute paths, with the most
generic one first.</p>
</li>
<li>
<p><code>get_user_module_dir( osarch, stack_name, stack_version )</code>: 
    Similar to <code>get_system_module_dir</code> but then for the modules in the user module tree.</p>
</li>
<li>
<p><code>get_user_module_dirs( osarch, stack_name, stack_version )</code>: 
    Similar to <code>get_system_module_dirs</code> but then for the modules in the user module tree.</p>
</li>
<li>
<p><code>get_system_inframodule_dir( osarch, stack_name, stack_version )</code>: Get the 
    infrastructure module directory for the given architecture, stack name and stack
    version. The function returns the absolute path: The system installation root is 
    obtained via the <code>get_system_install_root</code> function.</p>
</li>
<li>
<p><code>get_system_SW_dir( osarch, stack_name, stack_version )</code>: Get the system software
    installation directory for the given architecture, stack name and stack version.
    The function returns the absolute path: The system installation root is 
    obtained via the <code>get_system_install_root</code> function.</p>
</li>
<li>
<p><code>get_user_SW_dir( osarch, stack_name, stack_version )</code>: Get the user software
    installation directory for the given architecture, stack name and stack version.
    The function returns the absolute path: The user installation root is 
    obtained via the <code>get_user_install_root</code> function.</p>
</li>
<li>
<p><code>get_system_EBrepo_dir( osarch, stack_name, stack_version )</code>: Get the system EasyBuild
    repo directory for the given architecture, stack name and stack version. The function
    returns the absolute path; the system installation root is obtained via the 
    <code>get_system_install_root</code> function.</p>
</li>
<li>
<p><code>get_user_EBrepo_dir( osarch, stack_name, stack_version )</code>: Get the user EasyBuild
    repo directory for the given architecture, stack name and stack version. The function
    returns the absolute path; the user installation root is obtained via the 
    <code>get_user_install_root</code> function.</p>
</li>
</ul>
<h4 id="miscellaneous-functions">Miscellaneous functions</h4>
<ul>
<li>
<p><code>get_stack_subarchs( osarch, stack_version )</code>: Compute a list containing
    the given osarch and its subarchs in
    the hierarchy of the naming scheme for the stack. So the list can
    be at most 3 elements long. The most generic one is at the front of
    the list.</p>
<p>This is a helper function to <code>get_system_module_dirs</code>.</p>
</li>
<li>
<p><code>populate_cache_subarchs( stack_version )</code>: Populate a part of the cache variable
    <code>ClusterMod_cache_subarchs</code> initialized in <code>SitePackage_helper.lua</code> with the other 
    helper variables that are used throughout.</p>
<p>For each stack version, the cache variable will return <code>true</code> for each valid 
architecture string in the software architecture hierarchy for that stack
version.</p>
</li>
</ul>
<h2 id="sitepackage_system_infolua">SitePackage_system_info.lua</h2>
<h3 id="data-structures_2">Data structures</h3>
<p>This file needs several data structures to map properties detected on the system to 
the actual OS, CPU and accelerator names used in the module system.</p>
<p>Note that in the current implementation we maintain mappings to both the long and the
short names, and this has to be consistent with the various <code>map_*</code> tables in
<code>SitePackage_arch_hierarchy.lua</code>. </p>
<h4 id="mappings-to-long-names">Mappings to long names</h4>
<ul>
<li>
<p><code>cpustring_to_longtarget</code> is the mapping from the CPU string that can be found in
    <code>/proc/cpuinfo</code> to the names that are used in the module system. Several CPU strings
    can map to the same target.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">cpustring_to_longtarget</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">AuthenticAMD_23_49</span> <span class="o">=</span> <span class="s1">&#39;zen2&#39;</span><span class="p">,</span>
    <span class="n">GenuineIntel_6_62</span>  <span class="o">=</span> <span class="s1">&#39;ivybridge&#39;</span><span class="p">,</span>
    <span class="n">GenuineIntel_6_79</span>  <span class="o">=</span> <span class="s1">&#39;broadwell&#39;</span><span class="p">,</span>
    <span class="n">GenuineIntel_6_85</span>  <span class="o">=</span> <span class="s1">&#39;skylake&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><code>osname_to_longos</code> is the mapping from the OS names are reported in <code>/etc/os-release</code>
    in the <code>NAME</code> field to the names used in the module system. Multiple values can map onto
    the same OS in the stack, e.g., all Red Hat compatible OSes map to a single name.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">osname_to_longos</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">CentOS_Linux</span> <span class="o">=</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span>
    <span class="n">Rocky_Linux</span>  <span class="o">=</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><code>accelerator_to_longacc</code> is a more tricky table. It is used in the mapping from data
    read from the output of <code>lspci</code> to accelerator names, but the keys are not currently the
    values read with <code>lspci</code>. These values are hard coded in the routine that does detect
    the accelerator.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">accelerator_to_longacc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">AMD_MI100</span>    <span class="o">=</span> <span class="s1">&#39;arcturus&#39;</span><span class="p">,</span>
    <span class="n">NVIDIA_GA100</span> <span class="o">=</span> <span class="s1">&#39;ampere&#39;</span><span class="p">,</span>
    <span class="n">NVIDIA_GP100</span> <span class="o">=</span> <span class="s1">&#39;pascal&#39;</span><span class="p">,</span>
    <span class="n">NVIDIA_GP104</span> <span class="o">=</span> <span class="s1">&#39;P5000&#39;</span><span class="p">,</span>
    <span class="n">NEC_aurora1</span>  <span class="o">=</span> <span class="s1">&#39;aurora1&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
</ul>
<h4 id="mappings-to-short-names">Mappings to short names</h4>
<p>The structure of each of these associative tables is completely equivalent to their long
names equivalent, but using the short names as the value. </p>
<p>In principle they could be computed from the long names variants utilising the mapping 
tables from long to short names as defined in <code>SitePackage_arch_hierarchy.lua</code>.</p>
<ul>
<li><code>cpustring_to_shorttarget</code></li>
<li><code>osname_to_shortos</code></li>
<li><code>accelerator_to_shoracc</code></li>
</ul>
<h4 id="other-data-structures">Other data structures</h4>
<ul>
<li>
<p><code>os_version_type</code>: Indicates if for the OS we should use the major version only or 
    a major.minor version to distinguish architectures for the software stack.</p>
<p>The need grew out of a difference between CentOS which only reports the major version
in <code>/etc/os-release</code> in the <code>VERSION_ID</code> field and Rocky Linux which reports a major.minor
version, while we still use only the major version in the software stack.</p>
<p>Example
<div class="highlight"><pre><span></span><code><span class="kd">local</span> <span class="n">os_version_type</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">CentOS_Linux</span> <span class="o">=</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span>
    <span class="n">Rocky_Linux</span>  <span class="o">=</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
</ul>
<h3 id="routines_2">Routines</h3>
<h4 id="get_hostname"><code>get_hostname()</code></h4>
<p>Request the name of the host. The routine calls <code>/bin/hostname</code>.</p>
<h4 id="get_clustername"><code>get_clustername()</code></h4>
<p>Returns the name of the cluster as defined in the system definition through
the <code>ClusterMod_ClusterName</code> variable.</p>
<h4 id="get_stackname"><code>get_stackname()</code></h4>
<p>Returns the name of the primary software stack as defined in the system definition
through the <code>ClusterMod_StackName</code> variable.</p>
<h4 id="get_cpu_info"><code>get_cpu_info()</code></h4>
<p>Returns the CPU string derived from the data in <code>/proc/cpuinfo</code>, by combining 
information from the <code>vendor_id</code>, <code>family</code> and <code>model</code> lines (separated by an
underscore).</p>
<h4 id="get_os_info"><code>get_os_info()</code></h4>
<p>returns 2 values: name and version of the OS. The name is extracted
from the <code>NAME</code> line of <code>/etc/os-release</code>, the version from the <code>VERSION_ID</code> line
but it may be converted from major.minor to major format if told so by the 
<code>os_version_type</code> table.</p>
<h4 id="get_accelerator_info"><code>get_accelerator_info</code></h4>
<p>Extracts the accelerator type, returning <code>nil</code> if no accelerator
is found. The names returned are the long accelerator names used in the data structures.</p>
<p>Current return value:</p>
<ul>
<li>AMD_MI100    (vaughan AMD Instinct nodes)</li>
<li>NVIDIA_GP100 (leibniz Pascal nodes)</li>
<li>NVIDIA_GP104 (leibniz visualization node)</li>
<li>NVIDIA_GA100 (vaughan Ampere node)</li>
<li>NEC_aurora1  (leibniz Aurora node)</li>
</ul>
<h4 id="get_cluster_osarch"><code>get_cluster_osarch()</code></h4>
<p><code>get_clusterarch_longosarch</code> returns the cluster architecture in the os-cpu-accelerator
format with long names, e.g., <code>redhat8-zen2-noaccel</code> or <code>redhat8-skylake-aurora1</code>.
This is the format that in our naming conventions would be denoted as
<code>osarch</code>.</p>
<h4 id="get_clusterarch"><code>get_clusterarch()</code></h4>
<p><strong>This function may not be needed in the final implementation and may be eliminated
in favor of <code>get_cluster_osarch()</code>.</strong></p>
<p><code>get_clusterarch</code> returns the cluster architecture in four possible formats for the 
module system. It is then to the module system to select which one of the four it needs
for which purpose (and that depends on the <code>hierarchy</code> field in <code>ClusterMod_SystemProperties</code>
in <code>/etc/SysteDefinition.lua</code>). The four formats are two with long names and two with
short names, each time with three components or with only two components if there is no
accelerator.</p>
<p>Return values:</p>
<ol>
<li>Short minimal name, i.e., no <code>-host</code> is added for nodes without
    accelerator.</li>
<li>Long minimal name, i.e., no <code>-noaccel</code> is added for nodes without
    accelerator.</li>
<li>Short maximal name, with <code>-host</code> added for nodes without accelerator.
    This is the format that in our naming conventions would be denoted as
    <code>short_osarch</code>.</li>
<li>Long maximal name, with <code>-noaccel</code> added for nodes without accelerator</li>
</ol>
<p>e.g., <code>RH8-zen2, redhat8-zen2, RH8-zen2-host, redhat8-zen2-noaccel</code> or
<code>RH8-SKLX-NEC1, redhat8-skylake-aurora1, RH8-SKLX-NEC1, redhat8-skylake-aurora1</code>.
This is the format that in our naming conventions would be denoted as
<code>osarch</code>.</p>
<h4 id="get_fullos"><code>get_fullos()</code></h4>
<p>Returns the long OS name including the version (so the first component
of the formats with long names of <code>get_clusterarch</code>)</p>
<p>Example return value: <code>redhat8</code> on systems with CentOS 8.x or Rocky Linux 8.x.</p>
<h2 id="sitepackage_helperlua">SitePackage_helper.lua</h2>
<p>This file defines data structures derived from other data structures mentioned earlier
on this page, which implies that the order of <code>dofile</code> commands is important as the 
initialisation code is executed when the file is included.</p>
<h3 id="data-structures_3">Data structures</h3>
<h4 id="clustermod_sorted_archmap_keys"><code>ClusterMod_sorted_archmap_keys</code></h4>
<p>This data structure is a sorted list of the level 1 keys used in the 
<a href="#ClusterMod_map_arch_hierarchy"><code>ClusterMod_map_arch_hierarchy</code></a> data structure.
Its main purpose is to speed up a search routine in this file, to avoid always 
recomputing that data.</p>
<p>TODO: GET RID OF THIS STRUCTURE</p>
<h4 id="clustermod_sorted_cputogen_keys"><code>ClusterMod_sorted_cputogen_keys</code></h4>
<p>This data structure is a sorted list of the level 1 keys used in the 
<a href="#ClusterMod_map_cpu_to_gen"><code>ClusterMod_map_cpu_to_gen</code></a> data structure.
Its main purpose is to speed up a search routine in this file, to avoid always 
recomputing that data.</p>
<h4 id="clustermod_sorted_toparchreduction_keys"><code>ClusterMod_sorted_toparchreduction_keys</code></h4>
<p>This data structure is a sorted list of the level 1 keys used in the 
<a href="#ClusterMod_reduce_top_arch"><code>ClusterMod_reduce_top_arch</code></a> data structure.
Its main purpose is to speed up a search routine in this file, to avoid always 
recomputing that data.</p>
<h3 id="routines_3">Routines</h3>
<ul>
<li>
<p><code>get_matching_archmap_key( version )</code>: For a given numeric (i.e., yyyymm) version, returns
    the largest key in <code>ClusterMod_map_arch_hierarchy</code> not larger than the given version.</p>
</li>
<li>
<p><code>get_matching_defcpu_key( version )</code>: For a given numeric (i.e., yyyymm) version, returns
    the largest key in <code>ClusterMod_map_def_cpu</code> not larger than the given version.</p>
</li>
<li>
<p><code>get_matching_cputogen_key( version )</code>: For a given numeric (i.e., yyyymm) version, returns
    the largest key in <code>ClusterMod_map_cpu_to_gen</code> not larger than the given version.</p>
</li>
<li>
<p><code>get_matching_reducecpu_key( version )</code>: For a given numeric (i.e., yyyymm) version, returns
    the largest key in <code>ClusterMod_reduce_cpu</code> not larger than the given version.</p>
</li>
<li>
<p><code>get_matching_toparchreduction_key( version )</code>: For a given numeric (i.e., yyyymm) version, returns
    the largest key in <code>ClusterMod_reduce_top_arch</code> not larger than the given version.</p>
</li>
<li>
<p><code>is_Stack_SystemTable</code>: Check if a given stack version corresponds to a key in
    <code>ClusterMod_SystemTable</code>. We have to do this through a function that is then exported
    to the sandbox as module files do not have access to the data itself.</p>
<p>The main purpose of this function is simply to give more precise error messages
in case the data structures aren't updated properly after installing a new toolchain.
This problem should not occur as the routines to prepare the stack would fail themselves,
but you'll never know.</p>
</li>
<li>
<p><code>mkDir</code>: Create a directory, using the Lua <code>lfs</code> package. It really has the effect
    effect of <code>mkdir -p</code>, so it can create multiple levels from the given directory if
    needed.</p>
</li>
<li>
<p>'get_user_install_root': Compute the directory for the EasyBuild user installation,
    or nil if that is explicitly turned off by setting <code>EBU_USER_PREFIX</code> to an empty string.</p>
</li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 4, 2022</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../scripts/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Scripts" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Scripts
            </div>
          </div>
        </a>
      
      
        
        <a href="../easybuild/" class="md-footer__link md-footer__link--next" aria-label="Next: EasyBuild configuration" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              EasyBuild configuration
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/hpcuantwerpen" target="_blank" rel="noopener" title="HPC-UAntwerpen on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "navigation.indexes", "header.autohide", "toc.follow", "content.code.annotate", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>